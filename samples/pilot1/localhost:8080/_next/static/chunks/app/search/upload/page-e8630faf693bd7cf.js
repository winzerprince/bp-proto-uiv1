(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{9425:function(e,t,s){Promise.resolve().then(s.bind(s,8219))},8219:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(7437),r=s(2265),l=s(9376),n=s(7648),i=s(2451),o=s(2489),d=s(7689);let c=(0,s(9205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=s(3113),p=s(8736);function x(){var e;let t=(0,l.useRouter)(),[s,m]=(0,r.useState)([]),[p,x]=(0,r.useState)(""),[g,h]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)([{name:"BOM",type:"table",description:"Bill of Materials table"},{name:"title_block",type:"text",description:"Title block containing drawing metadata"},{name:"dimension",type:"text",description:"Dimensional annotation with measurements"},{name:"section_view",type:"figure",description:"Section or detail view diagram"}]),[w,k]=(0,r.useState)(!1),[C,Z]=(0,r.useState)({name:"",type:"text",description:""}),M=(0,r.useCallback)(e=>{e.preventDefault(),f(!0)},[]),_=(0,r.useCallback)(e=>{e.preventDefault(),f(!1)},[]),D=(0,r.useCallback)(e=>{e.preventDefault(),f(!1);let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|bmp|tiff|webp)$/i.test(e.name)).map(e=>({file:e,status:"pending"}));m(e=>[...e,...t])},[]),S=e=>{m(t=>t.filter((t,s)=>s!==e))},P=async()=>{if(0===s.length)return;j(!0),s.map(e=>({filename:e.file.name})),await new Promise(e=>setTimeout(e,500));let e=s.map((e,t)=>({...e,file_id:"file-".concat(Date.now(),"-").concat(t),upload_url:"https://storage.example.com/upload/".concat(Date.now(),"/").concat(t),status:"pending"}));m(e);for(let t=0;t<e.length;t++){m(e=>e.map((e,s)=>s===t?{...e,status:"uploading",progress:0}:e));for(let e=0;e<=100;e+=20)await new Promise(e=>setTimeout(e,200)),m(s=>s.map((s,a)=>a===t?{...s,progress:e}:s));m(e=>e.map((e,s)=>s===t?{...e,status:"uploaded",progress:100}:e))}e.map(e=>e.file_id),await new Promise(e=>setTimeout(e,500));let a="job-".concat(Date.now());j(!1),t.push("/search/jobs/".concat(a))},T=s.length>0&&s.every(e=>"uploaded"===e.status),F=s.some(e=>"uploading"===e.status);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(n.default,{href:"/search",className:"p-2 hover:bg-gray-100 rounded transition-colors",children:(0,a.jsx)(i.Z,{className:"w-5 h-5 text-gray-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"図面アップロード"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"複数の図面ファイルをアップロードして解析"})]})]})})}),(0,a.jsx)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-card shadow-sm border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"データセットタイトル（オプション）"}),(0,a.jsx)("input",{type:"text",value:p,onChange:e=>x(e.target.value),placeholder:"例: Q4 2025 技術図面解析",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"要素タグ"}),(0,a.jsxs)("div",{className:"space-y-2",children:[g.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map((e,t)=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm bg-purple-100 text-purple-700 rounded-lg group",title:e.description,children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsxs)("span",{className:"text-xs opacity-60",children:["(",e.type,")"]}),(0,a.jsx)("button",{onClick:()=>{h(g.filter((e,s)=>s!==t))},className:"hover:bg-purple-200 rounded transition-colors ml-1",children:(0,a.jsx)(o.Z,{className:"w-3 h-3"})})]},t))}),w?(0,a.jsxs)("div",{className:"border border-gray-300 rounded-lg p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"タグ名 *"}),(0,a.jsx)("input",{type:"text",value:C.name,onChange:e=>Z({...C,name:e.target.value}),placeholder:"例: welding_symbol",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"タイプ *"}),(0,a.jsxs)("select",{value:C.type,onChange:e=>Z({...C,type:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,a.jsx)("option",{value:"text",children:"text"}),(0,a.jsx)("option",{value:"table",children:"table"}),(0,a.jsx)("option",{value:"figure",children:"figure"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"説明（オプション）"}),(0,a.jsx)("textarea",{value:C.description,onChange:e=>Z({...C,description:e.target.value}),placeholder:"例: Welding symbols and specifications",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",rows:2})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{var e,t;if((null===(e=C.name)||void 0===e?void 0:e.trim())&&C.type&&!g.some(e=>e.name===C.name)){let e={name:C.name.trim(),type:C.type,description:(null===(t=C.description)||void 0===t?void 0:t.trim())||void 0};h([...g,e]),v.some(t=>t.name===e.name)||N([...v,e]),Z({name:"",type:"text",description:""}),k(!1)}},className:"flex-1 px-4 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed",disabled:!(null===(e=C.name)||void 0===e?void 0:e.trim())||!C.type,children:"追加"}),(0,a.jsx)("button",{onClick:()=>{Z({name:"",type:"text",description:""}),k(!1)},className:"px-4 py-2 text-sm border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"キャンセル"})]})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:v.filter(e=>!g.some(t=>t.name===e.name)).map((e,t)=>(0,a.jsxs)("button",{onClick:()=>h([...g,e]),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-sm border border-purple-300 text-purple-700 rounded-lg hover:bg-purple-50 transition-colors",title:e.description,children:[(0,a.jsxs)("span",{children:["+ ",e.name]}),(0,a.jsxs)("span",{className:"text-xs opacity-60",children:["(",e.type,")"]})]},t))}),(0,a.jsx)("button",{onClick:()=>k(!0),className:"w-full px-3 py-2 text-sm border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",children:"+ 新規タグを作成"})]})]})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-card shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ファイル選択"}),(0,a.jsxs)("div",{onDragOver:M,onDragLeave:_,onDrop:D,className:"\n                border-2 border-dashed rounded-lg p-12 text-center transition-colors\n                ".concat(b?"border-purple-400 bg-purple-50":"border-gray-300 bg-gray-50","\n              "),children:[(0,a.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-700 font-medium mb-2",children:"ファイルをドラッグ&ドロップ"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"または"}),(0,a.jsxs)("label",{className:"inline-block px-6 py-2 bg-purple-600 text-white rounded-button font-medium hover:bg-purple-700 transition-colors cursor-pointer",children:[(0,a.jsx)("input",{type:"file",multiple:!0,accept:"image/*,.jpg,.jpeg,.png,.gif,.bmp,.tiff,.webp",onChange:e=>{if(!e.target.files)return;let t=Array.from(e.target.files).filter(e=>e.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|bmp|tiff|webp)$/i.test(e.name)).map(e=>({file:e,status:"pending"}));m(e=>[...e,...t])},className:"hidden"}),"ファイルを選択"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-4",children:"画像ファイル対応（JPG, PNG, GIF, BMP, TIFF, WebP）（最大1000ファイル）"})]})]}),s.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-card shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["アップロードファイル (",s.length,")"]}),!F&&!T&&(0,a.jsx)("button",{onClick:()=>m([]),className:"text-sm text-gray-600 hover:text-gray-900",children:"すべて削除"})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.map((e,t)=>(0,a.jsx)(u,{file:e,onRemove:()=>S(t)},t))})]}),s.length>100&&(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3",children:[(0,a.jsx)(c,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-amber-900",children:"大量ファイルのアップロード"}),(0,a.jsxs)("p",{className:"text-sm text-amber-700 mt-1",children:[s.length,"ファイルのアップロードには時間がかかる場合があります（推定: ",Math.ceil(s.length/10),"分）"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)(n.default,{href:"/search",className:"px-6 py-3 border border-gray-300 rounded-button font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"キャンセル"}),(0,a.jsx)("button",{onClick:P,disabled:0===s.length||y||F,className:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-button font-medium hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed",children:y||F?"アップロード中...":"データセットを作成 (".concat(s.length,"ファイル)")})]})]})})]})}function u(e){let{file:t,onRemove:s}=e,r={pending:{label:"待機中",class:"bg-gray-100 text-gray-700"},uploading:{label:"アップロード中",class:"bg-blue-100 text-blue-700"},uploaded:{label:"アップロード完了",class:"bg-green-100 text-green-700"},error:{label:"エラー",class:"bg-red-100 text-red-700"}}[t.status],l=t.file.type.startsWith("image/")||/\.(jpg|jpeg|png|gif|bmp|tiff|webp)$/i.test(t.file.name);return(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg",children:[l?(0,a.jsx)(m.Z,{className:"w-5 h-5 text-purple-400 flex-shrink-0"}):(0,a.jsx)(p.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.file.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded ".concat(r.class),children:r.label}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[(t.file.size/1024/1024).toFixed(2)," MB"]})]}),"uploading"===t.status&&void 0!==t.progress&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-purple-600 transition-all duration-300",style:{width:"".concat(t.progress,"%")}})})}),"error"===t.status&&t.error&&(0,a.jsx)("p",{className:"text-xs text-red-600 mt-1",children:t.error})]}),("pending"===t.status||"error"===t.status)&&(0,a.jsx)("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded transition-colors flex-shrink-0",children:(0,a.jsx)(o.Z,{className:"w-4 h-4 text-gray-500"})})]})}},2451:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},8736:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},3113:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},7689:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},2489:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[216,971,117,744],function(){return e(e.s=9425)}),_N_E=e.O()}]);