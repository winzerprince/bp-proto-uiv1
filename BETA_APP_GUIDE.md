# Blueprint Analysis Automation System - Beta Version

## アプリケーション概要

建設業界向けの図面分析自動化システムのベータ版です。AIを活用して以下の機能を提供します：

- **自動検図 (INSPECTION)**: 構造図と施工図の整合性チェック
- **自動BOM生成 (BOM)**: 図面から部品表を自動抽出
- **図面検索 (SEARCH)**: AIによる図面分析と検索

## 主要機能

### ✅ 実装済み機能

#### 1. マルチテナンシー & ユーザー管理
- 複数企業（テナント）のデータ完全分離
- ロールベースアクセス制御：
  - **一般ユーザー**: 自社のジョブの閲覧・作成
  - **テナント管理者**: 自社ユーザーの管理
  - **システム管理者**: 全テナントの管理

#### 2. 認証システム
- ログイン/ログアウト
- テナント選択 → ユーザー選択
- ロール別の画面表示制御

#### 3. ダッシュボード
- リアルタイム統計（アクティブジョブ、完了数、平均処理時間）
- クイックアクション（新規ジョブ作成）
- 最近のジョブ一覧

#### 4. ジョブ管理
- **ジョブ一覧**: フィルタリング（ステータス、タスクタイプ、日付）、検索、ソート
- **ジョブ作成**: 2ステップウィザード
  - Step 1: タスク選択（INSPECTION/BOM/SEARCH）、メタデータ入力
  - Step 2: ファイルアップロード（ドラッグ&ドロップ、進捗表示）
- **ジョブ詳細**: ステータスタイムライン、ファイル一覧、リアルタイム進捗

#### 5. 検図結果レビュー（INSPECTION）
- **分割ペインレイアウト**:
  - 左: 図面ビューワー（ズーム、バウンディングボックス表示）
  - 右: 結果テーブル（フィルタリング、ソート）
- **高度なフィルタリング**:
  - 信頼度スライダー
  - 指摘タイプ、AI判定、ユーザーアクション
  - コメント検索
- **一括確認機能**: 信頼度しきい値による一括承認
- **エクスポート機能**: 
  - Excel/CSV形式
  - 確認済み項目のみオプション
  - 進捗表示付き

#### 6. 管理機能（Admin）
- **ユーザー管理**: CRUD操作、ロール割り当て、検索
- **テナント設定**: 基本情報、通知設定（メール/Slack）

#### 7. 非同期処理
- ジョブキューシステム
- リアルタイムステータス追跡
- 進捗バー（0-100%）
- ステータスフロー: 作成済み → アップロード中 → 準備完了 → 処理中 → 完了/失敗

## アクセス方法

### デモユーザー

#### テナント1: 建設会社A
- **システム管理者**: admin@example.com
- **テナント管理者**: admin@company-a.jp
- **一般ユーザー**: user1@company-a.jp

#### テナント2: 建設会社B  
- **テナント管理者**: admin@company-b.jp
- **一般ユーザー**: user1@company-b.jp

*パスワード不要（モックデータ）*

## 主要ワークフロー

### Flow 1: アップロードと実行
1. ログイン → ダッシュボード
2. 「新規ジョブを作成」クリック
3. タスクタイプ選択（INSPECTION/BOM/SEARCH）
4. ジョブ情報入力 → 「次へ」
5. ファイルアップロード（ドラッグ&ドロップ）
6. 自動処理開始 → ジョブ詳細で進捗確認
7. 完了後、結果レビュー

### Flow 2: 検図結果レビュー
1. ジョブ一覧から完了済みINSPECTIONジョブ選択
2. 「検図結果を確認」クリック
3. 分割画面で確認：
   - 左: 図面にバウンディングボックス表示
   - 右: 指摘一覧テーブル
4. 指摘をクリック → 図面上の該当箇所にジャンプ
5. ユーザーアクション選択（確認済み/要修正）
6. コメント追加
7. エクスポート

### Flow 3: 一括確認
1. 結果レビュー画面で「一括確認」クリック
2. 信頼度しきい値設定（例: 90%以上）
3. プレビュー確認
4. 「一括確認を実行」
5. 低信頼度項目を個別レビュー

## 技術スタック

- **Framework**: Next.js 16.0.3 (App Router)
- **React**: 19.2.0
- **Styling**: Tailwind CSS 4.0
- **Icons**: lucide-react
- **Font**: Noto Sans JP（日本語最適化）
- **State Management**: React Hooks + Context API
- **Mock Data**: /src/lib/mock-data.js（バックエンドシミュレーション）

## ディレクトリ構造

```
src/
├── app/
│   ├── layout.js                 # ルートレイアウト
│   ├── page.js                   # リダイレクト（/login）
│   ├── login/page.js             # ログイン画面
│   ├── dashboard/page.js         # ダッシュボード
│   ├── jobs/
│   │   ├── page.js              # ジョブ一覧
│   │   ├── new/page.js          # ジョブ作成
│   │   └── [id]/
│   │       ├── page.js          # ジョブ詳細
│   │       ├── results/page.js  # 検図結果（旧版）
│   │       └── results-v2/page.js # 検図結果（エクスポート機能付き）
│   └── admin/
│       ├── users/page.js        # ユーザー管理
│       └── settings/page.js     # テナント設定
├── components/
│   ├── ui/index.js              # 再利用可能UIコンポーネント
│   └── layout/index.js          # レイアウトコンポーネント
├── contexts/
│   └── AuthContext.js           # 認証コンテキスト
└── lib/
    └── mock-data.js             # モックデータ＆ヘルパー関数
```

## 画面一覧

| # | 画面名 | パス | 説明 |
|---|--------|------|------|
| 1 | ログイン | `/login` | テナント/ユーザー選択 |
| 2 | ダッシュボード | `/dashboard` | 統計とクイックアクション |
| 3 | ジョブ一覧 | `/jobs` | フィルタ可能なジョブテーブル |
| 4 | ジョブ作成 | `/jobs/new` | 2ステップウィザード |
| 5 | ジョブ詳細 | `/jobs/[id]` | ステータス監視 |
| 6 | 検図結果 | `/jobs/[id]/results-v2` | 分割ペインレビュー |
| 7 | ユーザー管理 | `/admin/users` | CRUD操作（管理者のみ） |
| 8 | テナント設定 | `/admin/settings` | 設定管理（管理者のみ） |

## デザイン原則

- **プロフェッショナル & クリーン**: 建設業界向けのミニマルUI
- **タスク指向**: 反復レビュー作業に最適化
- **エビデンス重視**: バウンディングボックスの視覚的強調
- **デスクトップ最適化**: 分割ペインレイアウト（>1024px）
- **カラーパレット**:
  - プライマリ: #004080（深い青）
  - セカンダリ: #6B7280（グレー）
  - 成功: #10B981（グリーン）
  - 警告: #F59E0B（イエロー）
  - エラー: #EF4444（レッド）

## 開発コマンド

```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# 本番サーバー起動
npm start

# Linting
npm run lint
```

## デプロイ準備

### Vercel推奨設定
- **Framework Preset**: Next.js
- **Build Command**: `npm run build`
- **Output Directory**: `.next`
- **Install Command**: `npm install`
- **Node Version**: 18.x 以上

### 環境変数（将来の実装用）
```
NEXT_PUBLIC_API_URL=https://api.example.com
NEXT_PUBLIC_WS_URL=wss://api.example.com
```

## 今後の実装予定

- [ ] 実バックエンドAPI接続
- [ ] WebSocket によるリアルタイム更新
- [ ] PDF/画像の実際の表示
- [ ] カスタムフィールド機能
- [ ] エクスポート時の画像埋め込み
- [ ] モバイル対応の強化
- [ ] アクセシビリティの完全対応（WCAG 2.1 AA）
- [ ] 多言語サポート（英語、中国語）

## パイロット版からの改善点

### Pilot 1 (node-2) との比較
- ✅ マルチテナンシー追加
- ✅ ロールベースアクセス制御
- ✅ 非同期ジョブ処理
- ✅ 進捗トラッキング
- ✅ 一括確認機能
- ✅ エクスポート機能

### Pilot 2 (node-3) との比較  
- ✅ 統合UI（全タスクタイプ対応）
- ✅ 管理機能追加
- ✅ プロフェッショナルなデザイン
- ✅ 結果レビュー最適化

## トラブルシューティング

### ログインできない
→ デモなのでパスワード不要。テナントとユーザーを選択するだけでOK

### ジョブが完了しない
→ モックデータなので自動で処理されます（数秒待機）

### 結果が表示されない
→ INSPECTIONタスクで「完了」ステータスのジョブのみ結果表示可能

### 管理画面が見えない
→ システム管理者またはテナント管理者でログインしてください

## サポート

質問や問題がある場合は、GitHubのIssueを作成してください。

---

**Version**: Beta 1.0  
**Last Updated**: 2025-11-20  
**Status**: Ready for User Testing on Vercel
